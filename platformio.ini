[platformio]
default_envs = nucleo-l432
extra_configs = platformio-local.ini

[env]
build_flags =
  -DVERSION='"${sysenv.MONTY_VERSION}"'
  -Wno-format
lib_compat_mode = strict

[env:native]
platform = native
build_flags = ${env.build_flags}
  -DNATIVE
  -std=c++11
  -fno-exceptions
  -Wall
  -Wextra

[stm32]
targets = upload
platform = ststm32
framework = cmsis
build_flags = ${env.build_flags}
  -DSTM32
# re: lib_deps, see https://github.com/platformio/platformio-core/issues/2573
lib_deps =
  JeeH
  mrfs
monitor_speed = 115200
test_transport = custom

[env:nucleo-l432]
extends = stm32
board = nucleo_l432kc
build_flags = ${stm32.build_flags}
  -DSTM32L4

# this variant is only used to compare the build size with assertions disabled
[env:noassert]
extends = stm32
targets = size
board = nucleo_l432kc
build_flags = ${stm32.build_flags}
  -DSTM32L4
  -DNDEBUG

# and this variant also stubs out the entire Python VM
[env:nopyvm]
extends = stm32
targets = size
board = nucleo_l432kc
build_flags = ${stm32.build_flags}
  -DSTM32L4
  -DNDEBUG
  -DNOPYVM

# code generator settings, see tasks.py
[codegen]
all =
native = lib/arch-native/
stm32 = lib/arch-stm32/
